<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Details</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <a class="logo" href="/">Al Watani</a>
        <a href="index.html" class="btn" style="background:transparent; border:1px solid #ffffff33;">Back to List</a>
    </header>

    <div class="container" id="detail-container"></div>

    <footer>
        <p>&copy; 2023 Al Watani. All rights reserved.</p>
    </footer>

    <script src="app.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        let currentImageIndex = 0;
        let carImages = [];

        async function loadCarDetail() {
            try {
                const res = await fetch(`${API_URL}/cars/${id}`);
                if (!res.ok) throw new Error("Car not found");
                const car = await res.json();

                if (car.images && car.images.length > 0) {
                    carImages = car.images.map(img => img.image_url);
                } else {
                    carImages = [car.image_url];
                }

                const container = document.getElementById('detail-container');
                
                // New Professional Split Layout
                container.innerHTML = `
                    <div class="detail-grid">
                        <div class="slider-container">
                            <button class="slider-btn prev-btn" onclick="changeSlide(-1)">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <img id="main-slider-image" src="${getFullUrl(carImages[0])}" class="slider-img" alt="Car Image">
                            <button class="slider-btn next-btn" onclick="changeSlide(1)">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>

                        <div style="display:flex; flex-direction:column;">
                            <span style="color:var(--text-light); font-weight:600; font-size:0.9rem;">${car.year} Model</span>
                            <h1 style="font-size: 2.5rem; margin-bottom: 10px;">${car.brand} ${car.model}</h1>
                            <h3 class="price" style="font-size: 2.5rem; margin-bottom: 20px; color:var(--primary);">$${car.price.toLocaleString()}</h3>

                            <div class="specs-row" style="margin-bottom: 30px;">
                                <div class="spec-badge" style="padding:10px 15px; background:#e0f2fe; color:var(--primary-dark);">
                                    <i class="fa-solid fa-gauge"></i> ${car.mileage.toLocaleString()} km
                                </div>
                                <div class="spec-badge" style="padding:10px 15px; background:#e0f2fe; color:var(--primary-dark);">
                                    <i class="fa-solid fa-calendar"></i> ${car.year}
                                </div>
                            </div>

                            <h4 style="margin-bottom:10px;">Description</h4>
                            <p style="color: var(--text-main); line-height: 1.8; margin-bottom: 30px;">${car.description}</p>

                            <button class="btn btn-block" style="margin-top:auto; padding: 15px; font-size:1.1rem;">
                                <i class="fa-brands fa-whatsapp"></i> &nbsp;Contact Seller
                            </button>
                        </div>
                    </div>
                `;
            } catch (err) {
                document.getElementById('detail-container').innerHTML = `<h2>Error: ${err.message}</h2>`;
            }
        }

        function changeSlide(direction) {
            currentImageIndex += direction;
            if (currentImageIndex >= carImages.length) currentImageIndex = 0;
            else if (currentImageIndex < 0) currentImageIndex = carImages.length - 1;
            document.getElementById('main-slider-image').src = getFullUrl(carImages[currentImageIndex]);
        }

        function getFullUrl(path) {
            return path.startsWith('http') ? path : `${API_URL}${path}`;
        }

        loadCarDetail();
    </script>
</body>
</html>