<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Watani | Premium Car Market</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header>
        <a class="logo" href="/">Al Watani</a>
        <nav>
            <a href="/">Home</a>
            <a href="https://maps.app.goo.gl/53EEvV7wZupX5ht47" target="_blank">Locations</a>
        </nav>
        <a href="login.html" class="btn" style="margin-left: 20px; background:transparent; border:1px solid #ffffff33;">
            <i class="fa-solid fa-lock"></i> &nbsp;Admin
        </a>
    </header>

    <section class="hero">
        <h1>Find Your Dream Car</h1>
        <p>Morocco's most trusted marketplace for premium vehicles.</p>
        <div style="margin-top: 20px;">
            <a href="#car-list" class="btn btn-primary" style="padding: 15px 30px; font-size: 1.1rem;">
                Browse Inventory
            </a>
        </div>
    </section>

    <div class="container">
        <h3 class="section-title"><i class="fa-solid fa-fire" style="color:var(--danger)"></i> Latest Arrivals</h3>
        <div id="car-list" class="card-grid"></div>
    </div>

    <footer>
        <p>&copy; 2023 Al Watani. All rights reserved.</p>
    </footer>

    <script src="app.js"></script>
    <script>
        const token = getToken();

        // --- 1. HANDLE HEADER LOGIC (Run this ONCE, outside the loop) ---
        if (token) {
            // Hide the Admin Login button (assumes it's the first .btn in header)
            // Better to give the login button an ID in HTML, but this works if structure is static
            const loginBtn = document.querySelector('header .btn'); 
            if(loginBtn) loginBtn.style.display = 'none';

            // Create Dashboard Button
            const dashboardBtn = document.createElement('a');
            dashboardBtn.href = 'dashboard.html';
            dashboardBtn.className = 'btn';
            dashboardBtn.style.marginLeft = '20px';
            dashboardBtn.style.background = 'var(--primary)';
            dashboardBtn.style.border = 'none';
            dashboardBtn.style.borderRadius = '50px';
            dashboardBtn.style.padding = '8px 10px';
            dashboardBtn.innerHTML = '<i class="fa-solid fa-gauge-high"></i> Dashboard';
            const nav = document.createElement('nav');
            const logoutBtn = document.createElement('button');
            logoutBtn.className = 'btn';
            logoutBtn.style.marginLeft = '10px';
            logoutBtn.style.background = 'transparent';
            logoutBtn.style.border = '2px solid #fee2e2';
            logoutBtn.style.borderRadius = '50px';
            logoutBtn.style.color = 'var(--danger)';
            logoutBtn.innerHTML = '<i class="fa-solid fa-power-off"></i> Logout';
            logoutBtn.onclick = logout;
            nav.appendChild(dashboardBtn);
            nav.appendChild(logoutBtn);
            
            // Append to nav or header
            document.querySelector('header').appendChild(nav);
        }

        // --- 2. FETCH AND DISPLAY CARS ---
        fetch(`${API_URL}/cars`)
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('car-list');
                
                // Only loop for creating cards
                data.forEach(car => {
                    const imgUrl = car.image_url.startsWith('http') ? car.image_url : `${API_URL}${car.image_url}`;

                    container.innerHTML += `
                        <a href="detail.html?id=${car.id}" class="card">
                            <div class="card-img-wrapper">
                                <img src="${imgUrl}" alt="${car.brand}">
                            </div>
                            <div class="card-body">
                                <h3 class="card-title">${car.brand} ${car.model}</h3>
                                
                                <div class="specs-row">
                                    <span class="spec-badge"><i class="fa-solid fa-calendar"></i> ${car.year}</span>
                                    <span class="spec-badge"><i class="fa-solid fa-gauge"></i> ${car.mileage.toLocaleString()} km</span>
                                </div>
                                
                                <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-top:auto;">
                                    <p class="price">$${car.price.toLocaleString()}</p>
                                    <span style="color:var(--primary); font-size:0.9rem; font-weight:600;">View <i class="fa-solid fa-arrow-right"></i></span>
                                </div>
                            </div>
                        </a>
                    `;
                });
            });
    </script>
</body>

</html>